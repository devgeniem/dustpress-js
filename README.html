<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
</head>
<body>
<p><img src="https://cloud.githubusercontent.com/assets/5691777/14319886/9ae46166-fc1b-11e5-9630-d60aa3dc4f9e.png" alt="geniem-github-banner" /></p>

<h1 id="dustpressplugin:dustpress.js">DustPress Plugin: DustPress.js</h1>

<p>A DustPress plugin that provides a handy JavaScript library for using your DustPress model methods on the front end.</p>

<ul>
<li>Contributors: <a href="https://github.com/devgeniem">devgeniem</a> / <a href="https://github.com/Nomafin">Nomafin</a>, <a href="https://github.com/villesiltala">villesiltala</a></li>
<li>Plugin url: https://github.com/devgeniem/dustpress-debugger</li>
<li>Tags: dustpress, wordpress, plugins, dustjs, dust.js</li>
<li>Requires at least: 4.2.0</li>
<li>Requires DustPress version: 1.7.0</li>
<li>Tested up to: 4.9.3</li>
<li>License: GPL&#8211;3.0</li>
<li>License URI: http://www.gnu.org/licenses/gpl&#8211;3.0.html</li>
</ul>

<h2 id="usage">Usage</h2>

<p>You can call for <code>SomeModel</code>&#8217;s method <code>SomeMethod</code> with following code:</p>

<pre><code>dp(&quot;SomeModel/SomeMethod&quot;, {
    tidy: true,
    args: {
        'foo': 'bar'
    }
    success: function( data ) {
        // do what you want with the data
    },
    error: function( error ) {
        // possible error
    }
});
</code></pre>

<p><code>tidy: true</code> parameter cleans up the data tree a bit for more usability. Feel free to try the queries with and without it to see the difference.</p>

<p><code>args</code> parameter passes arguments to the PHP side. They can be accessed there with <code>$this-&gt;get_args();</code>.</p>

<p>If you want, you can even render HTML with Dust templates.</p>

<pre><code>dp( 'SomeModel/SomeMethod', {
    partial: 'SomePartial',
    success: function( data ) {
        // do what you want with the data
    },
    error: function( error ) {
        // possible error
    }
});
</code></pre>

<p>This code takes the data of <code>SomeMethod</code> and renders it with <code>SomePartial</code>. Variable <code>data</code> then contains the ready html.</p>

<p>If you still want to get the data output as well, use argument <code>data: true</code> and you will get the resulting data as the second parameter of your success function.</p>

<p>You can also omit the method completely if you want to get the data of a complete model.</p>

<pre><code>dp( 'SomeModel', {
    success: function( data ) {
        // do what you want with the data
    },
    error: function( error ) {
        // possible error
    }
});
</code></pre>

<p>If you want to call several functions but not all at once, you can do so by replacing the method&#8217;s name on the call with a comma-separated list.
<code>
dp( 'SomeModel/SomeMethod,AnotherMethod', {
    success: function( data ) {
        // data.SomeMethod and data.AnotherMethod contain the return values
    },
    error: function( error ) {
        // possible error
    }
});
</code></p>

<p>Now data will consist of an object with the methods&#8217; names as keys and their return values as the values. Obviously you can also render that to HTML as well.</p>

<h3 id="modelfunctionfront-endvisibility">Model function front-end visibility</h3>

<p>You need to make your methods accessible for DustPress.js by defining a property named <code>$api</code> in your model. It should be an array consisting of the names of your accessible methods. DustPress.js can also run <code>protected</code> methods which are not automatically run by DustPress normally.</p>

<pre><code>class SomeModel extends DustPressModel {
    public $api = [
        'SomeMethod'
    ];

    protected function SomeMethod() {
        // Some code..
    }
}
</code></pre>

<p>If you need to determine whether a call has been made from ajax or not, you can use <code>dustpress()-&gt;is_dustpress_ajax()</code> function like shown below:</p>

<pre><code>class SomeModel extends DustPressModel {
    public $api = [
        'PublicMethod'
    ];

    public function PublicMethod() {
        if ( dustpress()-&gt;is_dustpress_ajax() ) {
            // Do not run if this an ajax request.
            return;
        }
        // Some code..
    }
}
</code></pre>

<h2 id="install">Install</h2>

<p>Recommended installation to a WordPress project is through composer:
<code>
$ composer require devgeniem/dustpress-js
</code></p>

<p>Obviously you can also download the ZIP file from GitHub and extract it into your plugins directory.</p>

</body>
</html>
